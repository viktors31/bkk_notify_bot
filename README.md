# BKK Notify Service - автоматизированная пересылка и редактирование сообщений в Telegram

## Описание
BKK Notify Service - приложение .NET, взаимодействующее с Telegram. Небольшой фоновый сервис, используя популярные библиотеки, осуществляет пересылку сообщений из личного чата в заданный чат, группу чатов. В отдельном Handler написана обработка сообщений - можно сделать свою, используя стандартные строковые функции. Приложение позволяет прослушивать заданный личный чат (используя Ваш телеграм аккаунт) в заданную группу чатов (от имени Вашего бота).

## Архитектура/модульность
```
                   ┌─────────────────────────────────┐                      
                   │ .NET Worker Service Application │                      
                   └────────────────┬────────────────┘                      
           ┌─────────────┬──────────┼─────────────────────────┐             
┌──────────┴───────────┐ │┌─────────┴──────────┐  ┌───────────┴────────────┐
│ Telegram.Bot Library │ ││ BKK Notify Service │  │WTelegram.Client Library│
│(INJECTION: TRANSIENT)│ ││(Background Service)│  │(INJECTION: SINGLETONE) │
└──────────────────────┘ │└────────────────────┘  └────────────────────────┘
 [X] Connecting ur bot   │ [X]Client authorizing   [X] Providing access to  
     to Telegram server  │                             ur Telegram account  
                         │ [X]Listening for client                          
 [X] Sending messages    │    updates              [X] Keeping session      
     via ur bot          │                                                  
                         │ [X]Creating scope for                            
                         │    message processing                            
                         │                                                  
                         │┌──────────────────────┐                          
                         └┼   Message Handler    │                          
                          │(INJECTION: TRANSIENT)│                          
                          └──────────────────────┘                          
                           [X] Checking message sender                      
                                                                            
                           [X] Truncating text of message                   
                                                                            
                           [X] Sending message via bot
```

## Настройка и запуск
Можно запустить на любой машине с .NET. Написано на .NET 9. Т.к. в данном случае это background service и консоль не используется для ввода - можно развернуть daemon на linux. Перед запуском необходимо заполнить конфигурацию - appsettings.json. При первом входе потребуется ввести код, для ввода кода достаточно отправить его в личные сообщения с ботом. Важно: не отправляйте код боту от своего же аккаунта - телеграм прервет попытку входа (политика безопаности).
```

  "TELEGRAM" : {
    "Token" : "Токен от telegram bot",
    "ApiId" : "ApiId приложения телеграм из личного кабинета",
    "ApiHash" : "Api Hash приложения",
    "SessionPathname" : "./session" <- путь к файлу сессии
  },
  "APP" : {
    "Phone" : "Телефон телеграм аккаунта, с которого будет выполнен вход и прослушивание сообщений",
    "ClientToBotPeerId" : "Peer ID чата аккаунт - бот",
    "ListenPeerId" : "Peer ID чата, который будет прослушиваться",
    "ReceivingChatsIds" : [
      "Peer ID чата, куда бот отправит сообщение",
      "Peer ID чата, куда бот отправит сообщение"
    ]
  }
```

## Дополнительно
Приложение ведет лог в файл (использую Serilog). Путь к файлу сессии задается в appsettings, т.к. на разных системах он может расположиться по разному, если не задать явно. Поле ListenPeerId можно заполнить 0, в таком случае при запуске приложения бот будет выдавать в лог все сообщения с id чатов (лучше узнать id чата из приложения Telegram, не стоит собирать лог с чувствительной информацией).
При запуске приложения в личный чат бот присылает сообщение с IP адресом, с которого работает приложение и отчет об успешной/неудачной авторизации.


## Дополнительная информация
1. Бот не может прочитать/увидеть сообщение другого бота. Политика Телеграм. Поэтому приложение слушает сообщения со стороны клиента.
2. Для возможности входа и авторизации клиента код предоставляется в личные сообщения с ботом. Консольный ввод не предусмотрен, т.к. все таки это Background Service и при консаольном вводе приложение не получится развернуть как демон на linux.
3. При попытке отправить код входа в свой аккаунт от себя - попытка входа будет пресечена. Политика Телеграма для защиты от мошшеников. Отправляйте код от кого угодно, но не от себя.
4. Можно доставать и хранить сессии в базе данных, здесь это реализовывать не стал. (памятка на будущее)
5. Библиотека телеграм клиента полна функционала. Однако, она не предоставляет интерфейса, вдруг когда-то это будет важно. 
6. Отправка сообщений в чаты организована с задержкой в секунду. Напоминание о том, что без задержки, при большом потоке рассылок, можно получить бан.
7. ...
